/****************************************************************************/
/*                                                                          */
/*              VPIF 接口及 OV2640 CMOS 传感器测试                          */
/*                                                                          */
/*              2014年07月17日                                              */
/*                                                                          */
/****************************************************************************/
#include <App.h>

#include <VPIF/OV2640.h>

void write_SCCB(unsigned char Reg, unsigned char Data)
{
	I2CRegWrite(SOC_I2C_0_REGS, Reg, Data);
}

void OV2640Init(void)
{
	//SVGA 800*600
	write_SCCB(0xff, 0x01);
	write_SCCB(0x12, 0x80);
	Delay(0XFFFF);
	write_SCCB(0xff, 0x00);
	write_SCCB(0x2c, 0xff);
	write_SCCB(0x2e, 0xdf);
	write_SCCB(0xff, 0x01);
	write_SCCB(0x3c, 0x32);
	//
	write_SCCB(0x11, 0x00);
	write_SCCB(0x09, 0x02);
	write_SCCB(0x04, 0x28);
	write_SCCB(0x13, 0xe5);
	write_SCCB(0x14, 0x48);
	write_SCCB(0x2c, 0x0c);
	write_SCCB(0x33, 0x78);
	write_SCCB(0x3a, 0x33);
	write_SCCB(0x3b, 0xfB);
	//
	write_SCCB(0x3e, 0x00);
	write_SCCB(0x43, 0x11);
	write_SCCB(0x16, 0x10);
	//
	write_SCCB(0x39, 0x92);
	//
	write_SCCB(0x35, 0xda);
	write_SCCB(0x22, 0x1a);
	write_SCCB(0x37, 0xc3);
	write_SCCB(0x23, 0x00);
	write_SCCB(0x34, 0xc0);
	write_SCCB(0x36, 0x1a);
	write_SCCB(0x06, 0x88);
	write_SCCB(0x07, 0xc0);
	write_SCCB(0x0d, 0x87);
	write_SCCB(0x0e, 0x41);
	write_SCCB(0x4c, 0x00);
	write_SCCB(0x48, 0x00);
	write_SCCB(0x5B, 0x00);
	write_SCCB(0x42, 0x03);
	//
	write_SCCB(0x4a, 0x81);
	write_SCCB(0x21, 0x99);
	//
	write_SCCB(0x24, 0x40);
	write_SCCB(0x25, 0x38);
	write_SCCB(0x26, 0x82);
	write_SCCB(0x5c, 0x00);
	write_SCCB(0x63, 0x00);
	write_SCCB(0x46, 0x00);//0x22
	write_SCCB(0x0c, 0x3c);
	//
	write_SCCB(0x61, 0x70);
	write_SCCB(0x62, 0x80);
	write_SCCB(0x7c, 0x05);
	//
	write_SCCB(0x20, 0x80);
	write_SCCB(0x28, 0x30);
	write_SCCB(0x6c, 0x00);
	write_SCCB(0x6d, 0x80);
	write_SCCB(0x6e, 0x00);
	write_SCCB(0x70, 0x02);
	write_SCCB(0x71, 0x94);
	write_SCCB(0x73, 0xc1);
	//
	write_SCCB(0x12, 0x40);
	write_SCCB(0x17, 0x11);
	write_SCCB(0x18, 0x43);
	write_SCCB(0x19, 0x00);
	write_SCCB(0x1a, 0x4b);
	write_SCCB(0x32, 0x09);
	write_SCCB(0x37, 0xc0);
	write_SCCB(0x4f, 0xca);
	write_SCCB(0x50, 0xa8);
	write_SCCB(0x5a, 0x23);
	write_SCCB(0x6d, 0x00);
	write_SCCB(0x3d, 0x38);
	//
	write_SCCB(0xff, 0x00);
	write_SCCB(0xe5, 0x7f);
	write_SCCB(0xf9, 0xc0);
	write_SCCB(0x41, 0x24);
	write_SCCB(0xe0, 0x14);
	write_SCCB(0x76, 0xff);
	write_SCCB(0x33, 0xa0);
	write_SCCB(0x42, 0x20);
	write_SCCB(0x43, 0x18);
	write_SCCB(0x4c, 0x00);
	write_SCCB(0x87, 0xd5);
	write_SCCB(0x88, 0x3f);
	write_SCCB(0xd7, 0x03);
	write_SCCB(0xd9, 0x10);
	write_SCCB(0xd3, 0x82);
	//
	write_SCCB(0xc8, 0x08);
	write_SCCB(0xc9, 0x80);
	//
	write_SCCB(0x7c, 0x00);
	write_SCCB(0x7d, 0x00);
	write_SCCB(0x7c, 0x03);
	write_SCCB(0x7d, 0x48);
	write_SCCB(0x7d, 0x48);
	write_SCCB(0x7c, 0x08);
	write_SCCB(0x7d, 0x20);
	write_SCCB(0x7d, 0x10);
	write_SCCB(0x7d, 0x0e);
	//
	write_SCCB(0x90, 0x00);
	write_SCCB(0x91, 0x0e);
	write_SCCB(0x91, 0x1a);
	write_SCCB(0x91, 0x31);
	write_SCCB(0x91, 0x5a);
	write_SCCB(0x91, 0x69);
	write_SCCB(0x91, 0x75);
	write_SCCB(0x91, 0x7e);
	write_SCCB(0x91, 0x88);
	write_SCCB(0x91, 0x8f);
	write_SCCB(0x91, 0x96);
	write_SCCB(0x91, 0xa3);
	write_SCCB(0x91, 0xaf);
	write_SCCB(0x91, 0xc4);
	write_SCCB(0x91, 0xd7);
	write_SCCB(0x91, 0xe8);
	write_SCCB(0x91, 0x20);
	//
	write_SCCB(0x92, 0x00);
	write_SCCB(0x93, 0x06);
	write_SCCB(0x93, 0xe3);
	write_SCCB(0x93, 0x05);
	write_SCCB(0x93, 0x05);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x04);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x00);
	write_SCCB(0x93, 0x00);
	//
	write_SCCB(0x96, 0x00);
	write_SCCB(0x97, 0x08);
	write_SCCB(0x97, 0x19);
	write_SCCB(0x97, 0x02);
	write_SCCB(0x97, 0x0c);
	write_SCCB(0x97, 0x24);
	write_SCCB(0x97, 0x30);
	write_SCCB(0x97, 0x28);
	write_SCCB(0x97, 0x26);
	write_SCCB(0x97, 0x02);
	write_SCCB(0x97, 0x98);
	write_SCCB(0x97, 0x80);
	write_SCCB(0x97, 0x00);
	write_SCCB(0x97, 0x00);
	//
	write_SCCB(0xc3, 0xed);
	write_SCCB(0xa4, 0x00);
	write_SCCB(0xa8, 0x00);
	write_SCCB(0xc5, 0x11);
	write_SCCB(0xc6, 0x51);
	write_SCCB(0xbf, 0x80);
	write_SCCB(0xc7, 0x10);
	write_SCCB(0xb6, 0x66);
	write_SCCB(0xb8, 0xA5);
	write_SCCB(0xb7, 0x64);
	write_SCCB(0xb9, 0x7C);
	write_SCCB(0xb3, 0xaf);
	write_SCCB(0xb4, 0x97);
	write_SCCB(0xb5, 0xFF);
	write_SCCB(0xb0, 0xC5);
	write_SCCB(0xb1, 0x94);
	write_SCCB(0xb2, 0x0f);
	write_SCCB(0xc4, 0x5c);
	//
	write_SCCB(0xc0, 0x64);
	write_SCCB(0xc1, 0x4B);
	write_SCCB(0x8c, 0x00);
	write_SCCB(0x86, 0x3D);
	write_SCCB(0x50, 0x00);
	write_SCCB(0x51, 0xC8);
	write_SCCB(0x52, 0x96);
	write_SCCB(0x53, 0x00);
	write_SCCB(0x54, 0x00);
	write_SCCB(0x55, 0x00);
	write_SCCB(0x5a, 0xC8);
	write_SCCB(0x5b, 0x96);
	write_SCCB(0x5c, 0x00);
	write_SCCB(0xd3, 0x82);
	//
	write_SCCB(0xc3, 0xed);
	write_SCCB(0x7f, 0x00);
	//
	write_SCCB(0xda, 0x09);//0x08
	//
	write_SCCB(0xe5, 0x1f);
	write_SCCB(0xe1, 0x67);
	write_SCCB(0xe0, 0x00);
	write_SCCB(0xdd, 0x7f);
	write_SCCB(0x05, 0x00);
}

void OV2640Reset(void)
{
	I2CRegWrite(SOC_I2C_0_REGS,OV2640_DSP_RA_DLMT, 0x01);
	I2CRegWrite(SOC_I2C_0_REGS,OV2640_SENSOR_COM7, 0x80);
}

void SCCB_WriteRegs(const unsigned char* pbuf)
{
	while(1)
	{
		if((*pbuf == 0) && (*(pbuf + 1) == 0))
		{
			break;
		}
		else
		{
			I2CRegWrite(SOC_I2C_0_REGS,*pbuf++, *pbuf++);
		}
	}
}


const static unsigned char OV2640_AUTOEXPOSURE_LEVEL0[]=
{
	0xFF,	0x01,	0xff,
	0x24,	0x20,	0xff,
	0x25,	0x18,	0xff,
	0x26,	0x60,	0xff,
	0x00,	0x00,	0x00
};

const static unsigned char OV2640_AUTOEXPOSURE_LEVEL1[]=
{
	0xFF,	0x01,	0xff,
	0x24,	0x34,	0xff,
	0x25,	0x1c,	0xff,
	0x26,	0x70,	0xff,
	0x00,	0x00,	0x00
};
const static unsigned char OV2640_AUTOEXPOSURE_LEVEL2[]=
{
	0xFF,	0x01,	0xff,
	0x24,	0x3e,	0xff,
	0x25,	0x38,	0xff,
	0x26,	0x81,	0xff,
	0x00,	0x00,	0x00
};
const static unsigned char OV2640_AUTOEXPOSURE_LEVEL3[]=
{
	0xFF,	0x01,	0xff,
	0x24,	0x48,	0xff,
	0x25,	0x40,	0xff,
	0x26,	0x81,	0xff,
	0x00,	0x00,	0x00
};
const static unsigned char OV2640_AUTOEXPOSURE_LEVEL4[]=
{
	0xFF,	0x01,	0xff,
	0x24,	0x58,	0xff,
	0x25,	0x50,	0xff,
	0x26,	0x92,	0xff,
	0x00,	0x00,	0x00
};

void OV2640_AutoExposure(unsigned char level)
{
	switch(level)
	{
		case 0:
			SCCB_WriteRegs(OV2640_AUTOEXPOSURE_LEVEL0);
			break;
		case 1:
			SCCB_WriteRegs(OV2640_AUTOEXPOSURE_LEVEL1);
			break;
		case 2:
			SCCB_WriteRegs(OV2640_AUTOEXPOSURE_LEVEL2);
			break;
		case 3:
			SCCB_WriteRegs(OV2640_AUTOEXPOSURE_LEVEL3);
			break;
		case 4:
			SCCB_WriteRegs(OV2640_AUTOEXPOSURE_LEVEL4);
			break;
		default:
			SCCB_WriteRegs(OV2640_AUTOEXPOSURE_LEVEL0);
			break;
	}

}


void OV2640_BrightnessConfig(unsigned char Brightness)
{
	I2CRegWrite(SOC_I2C_0_REGS,0xff, 0x00);
	I2CRegWrite(SOC_I2C_0_REGS,0x7c, 0x00);
	I2CRegWrite(SOC_I2C_0_REGS,0x7d, 0x04);
	I2CRegWrite(SOC_I2C_0_REGS,0x7c, 0x09);
	I2CRegWrite(SOC_I2C_0_REGS,0x7d, Brightness);
	I2CRegWrite(SOC_I2C_0_REGS,0x7d, 0x00);
}
